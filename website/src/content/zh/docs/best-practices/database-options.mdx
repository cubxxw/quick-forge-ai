---
title: 数据库配置选项
description: 学习如何在 Quick Forge AI 中配置和切换 PostgreSQL 和 Supabase 数据库选项
category: 最佳实践
---

# 数据库配置选项

Quick Forge AI 支持两种数据库部署选项，为您的开发和生产环境提供灵活性：

1. **直接 PostgreSQL 部署（默认）**：使用 Docker 在应用程序旁边部署的 PostgreSQL 数据库
2. **Supabase 云服务**：连接到 Supabase 云中的托管 PostgreSQL 数据库

本指南将引导您完成这两个选项，包括配置和切换之间的详细步骤。

## 先决条件

在开始之前，请确保您有：

- 已安装和设置 Quick Forge AI
- Docker 和 Docker Compose（直接 PostgreSQL 部署需要）
- Supabase 账户（Supabase 选项需要）- [在此注册](https://supabase.com)

## 使用配置助手

配置数据库的最简单方法是使用我们内置的配置助手：

```bash
make configure-db
```

这个交互式脚本将：
1. 提示您选择数据库选项
2. 引导您输入必要的配置详细信息
3. 使用正确的设置更新您的 `.env` 文件
4. 为所选数据库选项准备您的环境

## 选项 1：直接 PostgreSQL 部署

### 自动设置

1. 运行配置助手：
   ```bash
   make configure-db
   ```

2. 为直接 PostgreSQL 部署选择选项 1：
   ```
   请选择您的数据库选项：
   1) 直接 PostgreSQL 部署（默认）
   2) Supabase 云服务
   输入您的选择 (1/2): 1
   ```

3. 当提示时输入 PostgreSQL 配置详细信息：
   ```
   PostgreSQL 服务器（默认：db）：
   PostgreSQL 端口（默认：5432）：
   PostgreSQL 用户（默认：postgres）：
   PostgreSQL 密码：your_secure_password
   PostgreSQL 数据库名称（默认：app）：
   ```

4. 启动您的服务：
   ```bash
   docker-compose up -d
   ```

### 手动设置

如果您更喜欢手动配置，请使用以下设置更新您的 `.env` 文件：

```
# PostgreSQL 直接部署配置
USE_SUPABASE=false
USE_POSTGRES_SERVICE=default
USE_POSTGRES_PRESTART_SERVICE=default
POSTGRES_SERVER=db
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_secure_password
POSTGRES_DB=app
```

然后启动您的服务：
```bash
docker-compose up -d
```

## 选项 2：Supabase 云服务

### 创建 Supabase 项目

1. 登录您的 [Supabase 账户](https://app.supabase.com)
2. 点击"新项目"并选择您的组织
3. 输入项目名称和安全的数据库密码
4. 选择靠近您目标用户的区域
5. 等待您的项目创建完成（通常需要 2-3 分钟）

### 获取您的 Supabase 连接字符串

1. 在您的 Supabase 项目控制面板中，转到"设置" → "数据库"
2. 向下滚动到"连接字符串"并选择"URI"
3. 复制连接字符串，它看起来像：
   ```
   postgresql://postgres:your-password@db.abcdefghijkl.supabase.co:5432/postgres
   ```

### 自动设置

1. 运行配置助手：
   ```bash
   make configure-db
   ```

2. 为 Supabase 云服务选择选项 2：
   ```
   请选择您的数据库选项：
   1) 直接 PostgreSQL 部署（默认）
   2) Supabase 云服务
   输入您的选择 (1/2): 2
   ```

3. 当提示时输入您的 Supabase 连接 URL：
   ```
   输入您的 Supabase 连接 URL (postgresql://...)：postgresql://postgres:your-password@db.abcdefghijkl.supabase.co:5432/postgres
   ```

4. 启动您的服务：
   ```bash
   docker-compose up -d
   ```

### 手动设置

如果您更喜欢手动配置，请使用以下设置更新您的 `.env` 文件：

```
# Supabase 配置
USE_SUPABASE=true
SUPABASE_URL=postgresql://postgres:your-password@db.abcdefghijkl.supabase.co:5432/postgres
USE_POSTGRES_SERVICE=none
USE_POSTGRES_PRESTART_SERVICE=none
```

然后启动您的服务：
```bash
docker-compose up -d
```

## 在选项之间切换

您可以随时在直接 PostgreSQL 部署和 Supabase 之间切换：

1. 再次运行配置助手：
   ```bash
   make configure-db
   ```

2. 选择您的新数据库选项并按照提示操作

3. 停止并重新启动您的服务：
   ```bash
   docker-compose down
   docker-compose up -d
   ```

**重要**：在切换数据库选项时，您的数据不会自动迁移。如果需要，您需要手动处理数据迁移。

## 在数据库之间迁移数据

### 从 PostgreSQL 导出

```bash
# 对于直接 PostgreSQL 部署
docker-compose exec db pg_dump -U postgres -d app > database_backup.sql

# 对于 Supabase（本地安装 psql 客户端）
pg_dump "postgresql://postgres:your-password@db.abcdefghijkl.supabase.co:5432/postgres" > database_backup.sql
```

### 导入到新数据库

```bash
# 对于直接 PostgreSQL 部署
cat database_backup.sql | docker-compose exec -T db psql -U postgres -d app

# 对于 Supabase（本地安装 psql 客户端）
psql "postgresql://postgres:your-password@db.abcdefghijkl.supabase.co:5432/postgres" < database_backup.sql
```

## 工作原理

Quick Forge AI 通过以下方式实现此功能：

1. `backend/app/core/config.py` 中的配置设置
2. `docker-compose.yml` 中的 Docker Compose 服务配置文件
3. `scripts/configure-database.sh` 的配置助手脚本

### 技术细节

- 使用直接 PostgreSQL 时，Docker Compose 中的 `db` 服务会激活
- 使用 Supabase 时，`db` 服务会禁用，后端直接连接到 Supabase
- 环境变量 `USE_SUPABASE` 控制使用哪种数据库配置
- `backend/app/core/config.py` 中的后端数据库 URI 逻辑决定连接详细信息

## 故障排查

### Supabase 连接问题

- 检查您的 Supabase 项目是否处于活动状态
- 验证您的连接字符串是否正确
- 确保您的 IP 地址在 Supabase 网络设置中被允许

### PostgreSQL 直接部署问题

- 使用 `docker-compose ps` 检查 PostgreSQL 容器是否正在运行
- 使用 `docker-compose logs db` 查看 PostgreSQL 日志
- 确保您的 `.env` 有正确的数据库凭证

## 最佳实践

- **开发**：使用直接 PostgreSQL 部署以便于开发
- **测试**：考虑使用 Supabase 进行共享测试环境
- **生产**：根据您的扩展需求和管理偏好选择
- **CI/CD**：对于 CI，直接 PostgreSQL 选项可能更可靠

通过支持这两个选项，Quick Forge AI 为您提供了根据特定需求和项目阶段选择合适数据库方法的灵活性。 